!function(){Vue.http.interceptors.push(function(t,s){t.credentials=!0,s()});new Vue({el:"body",data:{domain:"http://www.yinzishao.cn",status:{isTutorInfo:!1,isSuccess:"",isDefault:"",isInfoTipOne:!1,selected:"",isRegister:"",isLoading:!1,errorTip:"对不起，您只能选择一位老师",isTutor:!0,isNoTutor:!1,isEnlargeImg:!1,enlargeImg:""},recommendList:[],detailedList:[],jsonData:[],form:{size:9,start:0,hot:1},location:{latitude:"",longitude:""},signature:""},ready:function(){this.renderData(),this.status.isLoading=!0},methods:{down:function(){this.form.size=5,this.form.start++,0!==this.jsonData.length&&this.renderData()},renderData:function(){this.$http.post(this.domain+"/getTeachers",this.form,{crossOrigin:!0,headers:{"Content-Type":"application/json"}}).then(function(t){if(0==t.json().success)console.log(t.json().error);else{this.jsonData=t.json();var s=t.json();if(0!=s.length){for(var i=0;i<s.length;i++){""!=s[i].certificate_photo?s[i].certificate_photo=this.domain+s[i].certificate_photo:s[i].certificate_photo="../img/user02.png";for(var e=s[i].teach_show_photo,o=s[i].teach_show_photo.length,n=0;n<o;n++)e[n]=this.domain+e[n];"您已拒绝"==s[i].isInvited||"老师已拒绝"==s[i].isInvited?s[i].isRed=!0:s[i].isRed=!1}var a=this.recommendList.concat(s);this.$set("recommendList",a)}else 0==this.recommendList.length&&(this.status.isNoTutor=!0,this.status.isTutor=!1)}})},getSignature:function(){this.$http.post(this.domain+"/generate_signature",{timestamp:1482652615,nonceStr:"yinzishao"},{crossOrigin:!0,headers:{"Content-Type":"application/json"}}).then(function(t){if(console.log(t.json()),1==t.json().success){this.signature=t.json().signature;var s=this;wx.config({debug:!0,appId:"wx6fe7f0568b75d925",timestamp:1482652615,nonceStr:"yinzishao",signature:s.signature,jsApiList:["getLocation","openLocation"]}),this.onAllow()}else console.log(t.json().error)})},sendLocation:function(){this.$http.post(this.domain+"/setLocations",this.form,{crossOrigin:!0,headers:{"Content-Type":"application/json"}}).then(function(t){1==t.json().success&&(this.status.getLocation=!1)})},setLocation:function(){this.getSignature()},onAllow:function(){var t=this;wx.getLocation({type:"wgs84",success:function(s){alert(JSON.stringify(s)),t.location.latitude=s.latitude,t.location.longitude=s.longitude,this.sendLocation(),console.log("latitude : "+t.location.latitude+"--longitude : "+t.location.longitude)},cancel:function(t){alert("用户拒绝授权获取地理位置"),this.onSubmitQuestion("createParentOrder")}})},onRecommend:function(){this.status.isTutorInfo=!1},onMine:function(){window.location.href="./parentMyPage.html"},onAllTutor:function(){window.location.href="./parentAllTutor.html"},onTutorInfo:function(t){switch(this.status.isTutorInfo=!0,this.status.selected=t,this.status.isDefault=!1,this.status.isSuccess=!0,this.detailedList=this.recommendList[t],this.detailedList.isInvited){case"您已邀请":this.status.isDefault=!0,this.status.isSuccess=!1,this.status.isRegister="取消邀请";break;case"向您报名":this.status.isRegister="该老师已报名";break;case"您已拒绝":this.status.isDefault=!0,this.status.isSuccess=!1,this.status.isRegister="您已拒绝该老师";break;case"老师已拒绝":this.status.isDefault=!0,this.status.isSuccess=!1,this.status.isRegister="该老师已拒绝";break;case"您已同意":this.status.isRegister="您已接受该老师";break;case"管理员审核中":this.status.isRegister="管理员审核中";break;case"已成交":this.status.isRegister="双方已成交";break;case"":this.status.isRegister="邀请老师"}},onRegister1:function(t){var s,i,e;if("邀请老师"==this.status.isRegister)s=1,i="您已邀请",e="邀请成功";else{if("取消邀请"!=this.status.isRegister)return this.status.isTutorInfo=!1,!1;s=0,i="",e="取消成功"}this.$http.post(this.domain+"/inviteTeacher",{tea_id:this.recommendList[t].tea_id,type:s},{emulateJSON:!0,headers:{"Content-Type":"application/json"}}).then(function(s){if(console.log(s.json()),1==s.json().success){this.status.isRegister=e;var o=this;this.timer&&clearTimeout(this.timer),this.timer=setTimeout(function(){o.recommendList[t].isInvited=i,o.status.isTutorInfo=!1},1e3)}else{console.log(s.json().error);var o=this;this.status.errorTip=s.json().error,this.status.isTutorInfo=!1,this.status.isInfoTipOne=!0,this.timer&&clearTimeout(this.timer),this.timer=setTimeout(function(){o.status.isInfoTipOne=!1},2e3)}})},showImg:function(t){this.status.enlargeImg=this.detailedList.teach_show_photo[t],this.status.isEnlargeImg=!0},closeImg:function(){this.status.isEnlargeImg=!1},onClose:function(){this.status.isTutorInfo=!1}}})}();