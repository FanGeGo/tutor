!function(){Vue.http.interceptors.push(function(t,s){t.credentials=!0,s()});new Vue({el:"body",data:{timer:null,domain:"http://www.yinzishao.cn",status:{isUser:!1,isDeal:!0,isOther:!1,isLoading:!1,isUploadImg:!1,isDeleteImg:!1,selected:""},signature:"",imgs:[],form:{image:"",url:"",serverId:""}},computed:{isOnSubmit:function(){return""!=this.form.serverId}},ready:function(){this.render(),this.status.isLoading=!0},methods:{getSignature:function(){this.$http.post(this.domain+"/generate_signature",{timestamp:1482652615,nonceStr:"yinzishao"},{crossOrigin:!0,headers:{"Content-Type":"application/json"}}).then(function(t){console.log(t.json()),this.signature=t.json().signature;var s=this;wx.config({debug:!0,appId:"wx6fe7f0568b75d925",timestamp:1482652615,nonceStr:"yinzishao",signature:s.signature,jsApiList:["chooseImage","uploadImage"]})})},render:function(){this.$http.post(this.domain+"/getText",{key:["getImg"]},{crossOrigin:!0,headers:{"Content-Type":"application/json"}}).then(function(t){if(console.log(t.json()),1==t.json().success){for(var s=t.json().getImg,e=0;e<s.length;e++){var i=s[e].img;s[e].img=this.domain+i}this.$set("imgs",s)}else console.log(t.json().error)})},onUser:function(){window.location.href="./userAdministor.html"},onDeal:function(){window.location.href="./deal.html"},onOther:function(){window.location.href="./other.html"},onClose:function(){this.status.isUploadImg=!1},onClickImg:function(){""==this.signature&&this.getSignature(),this.status.isUploadImg=!0},onSubmitImg:function(t){return""!==this.form.serverId&&void this.$http.post(this.domain+"/changeText",{image:this.form.serverId,url:this.form.url},{crossOrigin:!0,headers:{"Content-Type":"application/json"}}).then(function(t){console.log(t.json()),1==t.json().success&&(this.status.isUploadImg=!1,this.imgs.push({img:this.domain+t.json().image}),this.form.image="",this.form.serverId="",this.form.url="")})},uploadImg:function(){var t=this;wx.ready(function(){wx.chooseImage({count:1,sizeType:["original","compressed"],sourceType:["album","camera"],success:function(s){console.log(s);var e=s.localIds[0];t.form.image=e,t.uploadImgTo(e)}})})},uploadImgTo:function(t){var s=this;wx.uploadImage({localId:t,isShowProgressTips:1,success:function(t){s.form.serverId=t.serverId}})},remove:function(t){this.status.selected=t,this.status.isDeleteImg=!0},onSureDelete:function(t){var s=this,e=this.imgs[t].img.split(this.domain);this.$http.post(this.domain+"/deleteBanner",{image:e[1]},{emulateJSON:!0,headers:{"Content-Type":"application/json"}}).then(function(e){console.log(e.json()),1==e.json().success?(this.imgs.splice(t,1),this.timer&&clearTimeout(this.timer),this.timer=setTimeout(function(){s.status.isDeleteImg=!1},300)):console.log(e.json().error)})},onCancel:function(){this.status.isDeleteImg=!1}}})}();