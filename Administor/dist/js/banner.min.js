!function(){Vue.http.interceptors.push(function(s,t){s.credentials=!0,t()});new Vue({el:"body",data:{timer:null,domain:"http://shaozi.beansonbar.cn",status:{isUser:!1,isDeal:!0,isOther:!1,isLoading:!1,isUploadImg:!1,isDeleteImg:!1,selected:""},signature:"",imgs:[],form:{image:"",url:"",serverId:""}},computed:{isOnSubmit:function(){return""!=this.form.serverId}},ready:function(){this.render(),this.status.isLoading=!0},methods:{getSignature:function(){this.$http.post(this.domain+"/generate_signature",{timestamp:1482652615,nonceStr:"yinzishao"},{crossOrigin:!0,headers:{"Content-Type":"application/json"}}).then(function(s){console.log(s.json()),this.signature=s.json().signature;var t=this;wx.config({debug:!1,appId:"wx6fe7f0568b75d925",timestamp:1482652615,nonceStr:"yinzishao",signature:t.signature,jsApiList:["chooseImage","uploadImage"]})})},render:function(){this.$http.post(this.domain+"/getText",{key:["getImg"]},{crossOrigin:!0,headers:{"Content-Type":"application/json"}}).then(function(s){if(console.log(s.json()),1==s.json().success){for(var t=s.json().getImg,e=0;e<t.length;e++){var i=t[e].img;t[e].img=this.domain+i}this.$set("imgs",t)}else console.log(s.json().error)})},onUser:function(){window.location.href="./userAdministor.html"},onDeal:function(){window.location.href="./deal.html"},onOther:function(){window.location.href="./other.html"},onClose:function(){this.status.isUploadImg=!1},onClickImg:function(){""==this.signature&&this.getSignature(),this.status.isUploadImg=!0},onSubmitImg:function(s){return""!==this.form.serverId&&void this.$http.post(this.domain+"/changeText",{image:this.form.serverId,url:this.form.url},{crossOrigin:!0,headers:{"Content-Type":"application/json"}}).then(function(s){console.log(s.json()),1==s.json().success&&(this.status.isUploadImg=!1,this.imgs.push({img:this.domain+s.json().image}),this.form.image="",this.form.serverId="",this.form.url="")})},uploadImg:function(){var s=this;wx.ready(function(){wx.chooseImage({count:1,sizeType:["original","compressed"],sourceType:["album","camera"],success:function(t){console.log(t);var e=t.localIds[0];s.form.image=e,s.uploadImgTo(e)}})})},uploadImgTo:function(s){var t=this;wx.uploadImage({localId:s,isShowProgressTips:1,success:function(s){t.form.serverId=s.serverId}})},remove:function(s){this.status.selected=s,this.status.isDeleteImg=!0},onSureDelete:function(s){var t=this,e=this.imgs[s].img.split(this.domain);this.$http.post(this.domain+"/deleteBanner",{image:e[1]},{emulateJSON:!0,headers:{"Content-Type":"application/json"}}).then(function(e){console.log(e.json()),1==e.json().success?(this.imgs.splice(s,1),this.timer&&clearTimeout(this.timer),this.timer=setTimeout(function(){t.status.isDeleteImg=!1},300)):console.log(e.json().error)})},onCancel:function(){this.status.isDeleteImg=!1}}})}();