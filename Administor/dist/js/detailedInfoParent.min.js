!function(){Vue.http.interceptors.push(function(t,s){t.credentials=!0,s()});new Vue({el:"body",data:{timer:null,domain:"http://www.yinzishao.cn:8000",status:{isSelecting:!0,isLoading:!1,isTutorInfo:!1,isChangeInfo:!1,isRemindTeacher:!1,isList:!0,isNoList:!1,text:"删除该请求",isSuccess:!0,onParent:!1,onTeacher:!1,isEnlargeImg:!1,enlargeImg:"",isDetailed:!0,errorTip:"对不起，您只能选择一位老师"},detailedList:{pd_id:0,name:"张先生",teacher_sex:"不限",learning_phase:"高中",aim:"提高成绩",subject:"数学",subject_other:"",grade:"高一",address:"大学城小洲",time:"周六上午",class_field:"成绩优良",teacher_method:"nice,细心",teacher_method_other:"",require:"上课要耐心细致，对孩子好",salary:"18/h",bonus:"100/月",deadline:"2016年12月23号",tel:"1234567891"},msgList:[],jsonData:[],msgDetailedList:[],start:0,msg:{text:"已发送请求"},form:{selected:"",isRegister:"",isMsg:""}},ready:function(){this.renderTutor(),this.renderOrderData(),this.status.isLoading=!0},methods:{down:function(){this.start++,0!==this.jsonData.length&&this.renderOrderData()},renderOrderData:function(){this.status.isSelecting=!0;var t=parseInt(this.getParam("listId"));this.$http.post(this.domain+"/getUserOrders",{id:t,user:"parent",start:this.start,size:6},{crossOrigin:!0,headers:{"Content-Type":"application/json"}}).then(function(t){if(console.log(t.json()),0==t.json().success)console.log(t.json().error);else{this.jsonData=t.json();var s=t.json();if(0!=s.length){for(var e=0;e<s.length;e++)"您已拒绝"==s[e].result||"老师已拒绝"==s[e].result?s[e].isRed=!0:s[e].isRed=!1;var i=this.msgList.concat(s);this.$set("msgList",i),this.status.isSelecting=!1}else 0==this.msgList.length&&(this.status.isNoList=!0,this.status.isList=!1)}})},grade_level:function(t){switch(t){case 0:return"";case 1:return"较为靠后";case 2:return"中等偏下";case 3:return"中等水平";case 4:return"中上水平";case 5:return"名列前茅"}},getParam:function(t){var s=location.search;if(s.indexOf("?")==-1)return"";s=s.substr(1,s.length).split("&");for(var e,i=0,n=s.length;i<n;i++)if(e=s[i].split("="),e[0]==t)return e[1]},renderTutor:function(){var t=parseInt(this.getParam("listId"));this.$http.post(this.domain+"/getInfo",{id:t,format:!0,user:"parent"},{crossOrigin:!0,headers:{"Content-Type":"application/json"}}).then(function(t){if(console.log(t.json()),0==t.json().sucess)console.log(t.json().error);else{var s=t.json();s.class_field=this.grade_level(s.class_field),this.$set("detailedList",s)}})},onReturn:function(){var t,s=this.getParam("keyword");t=s?s:"",console.log(this.getParam("keyword"),t),this.getParam("list")?window.location.href="./myList.html":window.location.href="./userAdministor.html?user=parent&keyword="+t},onUser:function(){window.location.href="./userAdministor.html"},onDeal:function(){window.location.href="./deal.html"},onOther:function(){window.location.href="./other.html"},onChangeRequest:function(t){window.location.href="./parentQuestion.html?changeInfoId="+t},onRemindParent:function(t){this.status.isRemindTeacher=!0;var s=this;this.timer&&clearTimeout(this.timer),this.timer=setTimeout(function(){s.status.isRemindTeacher=!1},1e3),"已发送请求"==this.msg.text&&this.$http.post(this.domain+"/remindFeedBack",{id:t,user:"parent"},{crossOrigin:!0,headers:{"Content-Type":"application/json; charset=UTF-8"}}).then(function(t){console.log(t.json()),1==t.json().success&&(this.msg.text="请勿重复发送请求")})},onDetailedInfo:function(t){this.form.selected=t,this.status.text="删除该请求",this.msgDetailedList=[];var s=this.msgList[t],e=this.getParam("list");this.$http.post(this.domain+"/getTeacherInfo",{tea_id:s.tea,format:!0},{crossOrigin:!0,headers:{"Content-Type":"application/json"}}).then(function(t){if(console.log(t.json()),0==t.json().success)console.log(t.json().error);else{var e=t.json();""!=e.certificate_photo&&null!=e.certificate_photo&&(e.certificate_photo=this.domain+e.certificate_photo);var i=e.teach_show_photo,n=i.length;if(n>0)for(var o=0;o<n;o++)i[o]=this.domain+i[o];null==s.expectation&&""==s.expectation||(e.expectation=s.expectation),this.msgDetailedList=e,this.status.isTutorInfo=!0}}),e?(this.status.isDetailed=!1,this.status.onParent=!0,this.status.onTeacher=!1,this.status.isSuccess=!0,"管理员审核中"==s.result?this.form.isRegister="管理员审核中":"已成交"==s.result?this.form.isRegister="双方已成交":"您已拒绝"==s.result?(this.status.isSuccess=!1,this.form.isRegister="您已拒绝该老师"):"老师已拒绝"==s.result?(this.status.isSuccess=!1,this.form.isRegister="该老师已拒绝"):"向您报名"==s.result?(this.status.onParent=!1,this.status.onTeacher=!0):"您已同意"==s.result&&(this.status.isSuccess=!1,this.form.isRegister="拒绝选择该老师")):(this.status.isDetailed=!0,this.status.onParent=!1,this.status.onTeacher=!1)},onDelete:function(t){this.$http.post(this.domain+"/deleteOrder",{oa_id:this.msgList[t].oa_id},{crossOrigin:!0,headers:{"Content-Type":"application/json"}}).then(function(s){if(1==s.json().success){var e=this;this.status.text="该请求已删除",this.timer&&clearTimeout(this.timer),this.timer=setTimeout(function(){e.msgList.splice(t,1),e.status.isTutorInfo=!1},800)}else console.log(s.json().error)})},onRegister1:function(t){return"拒绝选择该老师"!=this.form.isRegister?(this.status.isTutorInfo=!1,!1):(this.status.isTutorInfo=!1,this.form.isMsg="信息",this.status.isChangeInfo=!0,void 0)},onSelect:function(t){this.$http.post(this.domain+"/handleUserOrder",{willing:2,oa_id:this.msgList[t].oa_id,user:"parent"},{crossOrigin:!0,headers:{"Content-Type":"application/json"}}).then(function(s){if(1==s.json().success){var e=this;this.timer&&clearTimeout(this.timer),this.timer=setTimeout(function(){e.status.isTutorInfo=!1,e.msgList[t].result="您已同意",e.msgList[t].isRed=!1},1e3)}else console.log(s.json().error)})},onRefuse:function(t){this.$http.post(this.domain+"/handleUserOrder",{willing:0,oa_id:this.msgList[t].oa_id,user:"parent"},{crossOrigin:!0,headers:{"Content-Type":"application/json"}}).then(function(s){if(console.log(s.json()),1==s.json().success){var e=this;this.msgList[t].finish=1,this.timer&&clearTimeout(this.timer),this.timer=setTimeout(function(){e.status.isTutorInfo=!1,e.status.isChangeInfo=!1,e.msgList[t].result="您已拒绝",e.msgList[t].isRed=!0},1e3)}else console.log(s.json().error)})},onSureChange:function(t){this.onRefuse(t)},showImg:function(t){this.status.enlargeImg=this.msgDetailedList.teach_show_photo[t],this.status.isEnlargeImg=!0},closeImg:function(){this.status.isEnlargeImg=!1},onClose:function(){this.status.isChangeInfo=!1,this.status.isTutorInfo=!1,this.status.isInfoTipOne=!1}}})}();